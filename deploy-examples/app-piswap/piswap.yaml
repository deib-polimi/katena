tosca_definitions_version: tosca_simple_yaml_1_3

imports:
- nodes/contract.yaml
- nodes/network.yaml

topology_template:
  node_templates:
    ganache:
      type: katena.nodes.network.ganache
    userWallet: 
      type: katena.nodes.wallet
      requirements:
      - host: ganache
      properties:
        privateKey: { get_input: UserKeyGanache }

    token:
      type:  katena.nodes.contract
      requirements:
      - host: ganache
      - wallet: userWallet
      properties:
        abi: "MockERC721"
        parameters:
          - "TestToken" #string memory _name
          - "TST" # string memory _symbol
          - "askldskfjsl" # string memory _assetUrl
    ## MARKETSSS    
    market1:
      type: katena.nodes.beacon.proxy
      requirements:
      - host: ganache
      - wallet: userWallet
      - upgradableBeacon: registry
      properties:
        abi: "PiSwapMarket"
        parameters:
         - { get_attribute: [SELF, upgradableBeacon, implementation, contractAddress] } #tokenAddress
         - 0 #tokenId
         - "TST" #nftType
    market2:
      type: katena.nodes.beacon.proxy
      requirements:
      - host: ganache
      - wallet: userWallet
      - upgradableBeacon: registry
      properties:
        abi: "PiSwapMarket"
    registry:
      type: katena.nodes.beacon.upgradable
      requirements:
      - host: ganache
      - wallet: userWallet
      - implementation: token
      properties:
        abi: "PiSwapRegistry"
        parameters:
          -  { get_input: UserWallet } #address _owner,
          -  { get_input: UserWallet } #address _beneficiary,
          -  { get_attribute: [SELF, implementation, contractAddress] } #address _marketImplementation,
          -  { get_input: UserWallet }  #address _weth,
          -  "" #string calldata _uri - no calling any function

  inputs:
    UserKeyGanache:
      type: string
      required: true
    UserWallet:
      type: string
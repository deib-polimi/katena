tosca_definitions_version: tosca_simple_yaml_1_3

imports:
  - network.yaml

metadata:
  template_name: "toscachain.nodes.contract"

# relationship_types:
#   tosca.relationship.deployedOn:
  

node_types:
  toscachain.nodes.contract:
      derived_from: tosca.nodes.SoftwareComponent
      # requirements:
      #   - host:
      #       capability: tosca.capabilities.Container
      #       node: toscachain.nodes.network
      #       relationship:
      properties:
        abi:
          description: path to smart contract ABI
          type: string
          required: true
        privateKey:
          description: privateKey of the address that should perform the deploy
          type: string
          required: true
        interfaces:
          Standard:
            type: tosca.interfaces.node.lifecycle.Standard
topology_template:
  node_templates:
    ganache:
      type: toscachain.nodes.network
      properties:
        address: "127.0.0.1:8545"
    demo:
      type: toscachain.nodes.contract
      properties:
        abi: "Demo"
        privateKey: "0x3f42d213f49bbafa222a1590ea5355ec9ac8b300f26107ade7cad69dd59becac"
      requirements:
        - host: ganache
      interfaces:
        Standard:
          type: tosca.interfaces.node.lifecycle.Standard
          operations:
            create:
              inputs:
                abi: { type: string, default: { get_property: [SELF, abi] } }
                privateKey:
                  { type: string, default: { get_property: [SELF, privateKey] } }
                network:
                  {
                    type: string,
                    default:
                      { get_property: [ganache, address] },
                  }
              implementation:
                primary: playbooks/deploy_contract.yml

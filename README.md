# KATENA ⛓️ 

[![DOI](https://zenodo.org/badge/472717537.svg)](https://zenodo.org/badge/latestdoi/472717537)

Operations on Blockchain with TOSCA.

This repo contains all the files needed to deploy compiled etherum aplications that are complietn with spacific deploy patterns.

**NOTE**: to reproduce the experiments reported in the paper refer to [Experiments Reproducibility](#experiments-reproducibility) section. For each experiment, we provided the required step to run it.
If you want further information on how to use KATENA to deploy your applications refer to [Development](DEVELOPMENT.md) file. For extra information on Number of Tokens computation see [here](./NUMBER_OF_TOKENS.md).

## Install and run KATENA

The suggested way to reproduce the experiments is to use Docker (if not installed, check this [link](https://docs.docker.com/get-docker/)).

1. Clone this repository and navigate into the project folder
2. To build the KATENA Docker image execute
   ```
   docker build -t katena .
   ```
3. To access KATENA container execute
   ```
   docker run -it katena
   ```

## Experiments Reproducibility

The KATENA container allows automate the deployment of ethereum applications with different patterns:

1. Diamond 
2. Proxy (ERC1967)
3. upgradable Beacon 

Examples of this patterns and other apps more comples can be foind in the deploy-examples folder.

- ### To deploy a custom application

  To deploy an applications execute within the KATENA container the following command.

  ```
  ./deploy.sh -f <topology.ylm> -c <dir_containing_abis.yml>
  ```
  Where the <topology.ylm> defines the architcture of the ethereum network being deployed.

  The script automatically:

  - Bootstraps a Ganache instance.
  - Retrieves the credentials of Account 0 (among the ones generated by Ganache) and uses them to pay for transactions on the local Ganache Blockchain.
  - Stores these credentials in KATENA
  - Instructs KATENA to deploy the input topology

## Run tests

Scripts can be used to test deployment. This scripts, must be listed in a `test` folder in the same directory as the contracts ABIs. An example can be found at `deploy-examples/beacon`:

  ```
  python ./.katena/contracts/test/<script>.py
  ```

Informations about the contracts addres and other paramters can be found in the `deploy.log` file or in the `.katena/.opera` directory.

## Error logs

The errors produced by KATENA (if any) are stored in file `deploy.log`  at the  `.katena` directory.

## Repository structure

- [deploy-examples](./deploy-examples/): examples of blockchain deployments.

- [templates](./templates/) folder contains:

  - katena building blocks (folder `nodes`)
  - Ansible playbooks attached to xopera node and relationships types (folder `playbooks`)
  - Python scripts used to communicate with the chain (using Web3.py) (folder `scripts`)
- [contracts-examples](./contracts-examples/) Some solidity contracts used in the deploy examples
- [misc](./misc/)  miscellaneous  folder that holds a mix of different supplementary files,

tosca_definitions_version: tosca_simple_yaml_1_3

imports:
  - network.yaml

node_types:
  toscachain.nodes.contract:
    derived_from: tosca.nodes.Root
    requirements:
      - host:
          capability: tosca.capabilities.Container
          node: toscachain.nodes.network
          relationship: tosca.relationships.HostedOn
    properties:
      abi:
        description: path to smart contract ABI
        type: string
        required: true
      privateKey:
        description: privateKey of the address that should perform the deploy
        type: string
        required: true
      address:
        type: string
        required: true
        default: { get_property: [toscachain.nodes.network, address] }
    attributes:
      contract_address: # set after playbook execution
        type: string
        description: "Smart contract address when deployed"
    interfaces:
      Standard:
        type: tosca.interfaces.node.lifecycle.Standard
        operations:
          create:
            inputs:
              abi: { type: string, default: { get_property: [SELF, abi] } }
              privateKey:
                { type: string, default: { get_property: [SELF, privateKey] } }
              network:
                { type: string, default: { get_property: [SELF, address] } }
            outputs:
              contract_address: [SELF, contract_address]
            implementation:
              primary: playbooks/deploy_contract.yml
              dependencies:
                - scripts/
                - contracts/
